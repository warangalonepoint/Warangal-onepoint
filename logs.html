<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Logs | Onestop Society</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .header { background: black; color: white; padding: 15px; text-align: center; font-size: 24px; }
        .section { padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background: #007AFF; color: white; }
        .btn { padding: 10px 20px; margin: 10px 5px 0 0; background: black; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">Onestop Society â€” Admin Logs</div>

    <div class="section">
        <h2>Visitor Logs</h2>
        <button class="btn" onclick="loadCSV('visitors/Visitors.csv', 'visitorsTable')">Load Visitors Logs</button>
        <button class="btn" onclick="exportTable('visitorsTable', 'Visitors_Export')">Export Visitors CSV</button>
        <table id="visitorsTable">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="section">
        <h2>Complaint Logs</h2>
        <button class="btn" onclick="loadCSV('complaints/Complaints.csv', 'complaintsTable')">Load Complaints Logs</button>
        <button class="btn" onclick="exportTable('complaintsTable', 'Complaints_Export')">Export Complaints CSV</button>
        <table id="complaintsTable">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        function loadCSV(path, tableId) {
            fetch(`/${path}`)
                .then(response => response.text())
                .then(data => {
                    const rows = data.trim().split('\n').map(row => row.split(','));
                    const table = document.getElementById(tableId);
                    const thead = table.querySelector('thead');
                    const tbody = table.querySelector('tbody');
                    thead.innerHTML = '';
                    tbody.innerHTML = '';

                    let headerRow = '<tr>' + rows[0].map(cell => `<th>${cell}</th>`).join('') + '</tr>';
                    thead.innerHTML = headerRow;

                    for(let i=1; i<rows.length; i++) {
                        let rowHTML = '<tr>' + rows[i].map(cell => `<td>${cell}</td>`).join('') + '</tr>';
                        tbody.innerHTML += rowHTML;
                    }
                })
                .catch(err => alert('Error loading CSV file.'));
        }

        function exportTable(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            const rows = table.querySelectorAll('tr');

            rows.forEach(row => {
                const cols = row.querySelectorAll('th, td');
                let rowData = [];
                cols.forEach(col => rowData.push(col.innerText));
                csv.push(rowData.join(','));
            });

            const csvData = csv.join('\n');
            const hiddenElement = document.createElement('a');
            hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvData);
            hiddenElement.target = '_blank';
            hiddenElement.download = filename + '.csv';
            hiddenElement.click();
        }
    </script>

</body>
</html>
